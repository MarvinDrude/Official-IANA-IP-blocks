name: Dependabot auto-merge
on:
  workflow_run:
    workflows:
      - "Dependabot auto-approve"
    types:
      - completed
permissions:
  pull-requests: write
  contents: write
jobs:
  dependabot:
    runs-on: ubuntu-latest
    # Run only when the approve workflow completed successfully for a Dependabot PR
    if: >-
      github.repository == 'HotCakeX/Official-IANA-IP-blocks' &&
      github.event.workflow_run.conclusion == 'success' &&
      github.event.workflow_run.pull_requests != null &&
      github.event.workflow_run.pull_requests[0].user.login == 'dependabot[bot]'
    steps:
      - name: Enable auto-merge for Dependabot PRs
        run: |         
          # Enable auto-merge on the PR. GitHub will hold the merge until all required checks (CodeQL, CI, etc.) pass.
          gh pr merge --auto --merge "$PR_URL"
        env:
          PR_URL: ${{ github.event.workflow_run.pull_requests[0].html_url }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
